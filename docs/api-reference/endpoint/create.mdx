---
title: 'Register Agent and Plan'
openapi: 'POST /agent'
---

Registers a new AI agent along with a payment plan in a single transaction using the Nevermined Payments API.

This is the most common entrypoint for AI Builders looking to monetize their services immediately after deploying them.

## Example Usage

```ts
import { Payments, getERC20PriceConfig, getFixedCreditsConfig } from '@nevermined-io/payments'

const payments = Payments.getInstance({
  nvmApiKey: process.env.NVM_API_KEY,
      environment: 'live' // Or 'sandbox' for testing
})

const agentMetadata = {
  name: 'Corporate Swiss Law assistant',
  tags: ['legal', 'assistant'],
  dateCreated: new Date('2024-12-31')
}

const agentApi = {
  endpoints: [{ POST: 'https://example.com/api/query' }],
  agentDefinitionUrl: 'https://example.com/openapi.json' // URL to OpenAPI spec, MCP Manifest, or A2A agent card
}

const planMetadata = {
  name: 'Corporate Swiss Law Plan',
  description: 'Payment plan for legal assistant'
}

const planMetadata = {
  name: 'Corporate Swiss Law Plan',
  description: 'Payment plan for legal assistant'
}

// Configure pricing - 10 USDC fixed price
const priceInUSDC = getERC20PriceConfig(10_000_000n, USDC_ERC20_ADDRESS, builderAddress)

// Configure credits - 100 credits with 5 credits per request
const creditsConfig = getFixedCreditsConfig(100n, 5n)

const { agentId, planId } = await payments.agents.registerAgentAndPlan(
  agentMetadata,
  agentApi,
  planMetadata,
  priceInUSDC,
  creditsConfig,
  'credits' // Optional: accessLimit ('credits' or 'time')
)
```

## Parameters

- `agentMetadata`: Metadata about the AI agent including name, tags, and creation date.
- `agentApi`: Defines the query endpoints the agent exposes. Must include:
  - `endpoints`: Array of endpoint objects with HTTP verb and URL pattern
  - `agentDefinitionUrl`: URL to the agent definition. Can be an OpenAPI spec, MCP Manifest, or A2A agent card. This field is mandatory.
- `planMetadata`: Metadata about the payment plan including name and description.
- `priceConfig`: Configuration object describing cost, token type, and receiver(s).
- `creditsConfig`: Defines what the subscriber gets (number of credits, expiration, etc.).
- `accessLimit` (optional): Type of access limit. Can be `'credits'` or `'time'`. If not specified, it's automatically inferred based on `creditsConfig.durationSecs`.

## Returns

```ts
{
  agentId: string
  planId: string
}
```

Returns the unique identifiers of the newly created agent and the payment plan.

## Notes

- You must initialize the `Payments` client before calling this method.
- The plan will immediately be associated with the registered agent.
- All pricing and credit logic is enforced on-chain.
