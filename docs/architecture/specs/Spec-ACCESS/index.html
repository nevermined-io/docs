<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-architecture/specs/Spec-ACCESS" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Decentralized Access Control | Nevermined Core Protocol Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.nevermined.io/docs/architecture/specs/Spec-ACCESS"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Decentralized Access Control | Nevermined Core Protocol Documentation"><meta data-rh="true" name="description" content="Decentralized Access Control"><meta data-rh="true" property="og:description" content="Decentralized Access Control"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.nevermined.io/docs/architecture/specs/Spec-ACCESS"><link data-rh="true" rel="alternate" href="https://docs.nevermined.io/docs/architecture/specs/Spec-ACCESS" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.nevermined.io/docs/architecture/specs/Spec-ACCESS" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://IB2HKPUD05-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Nevermined Core Protocol Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Nevermined Core Protocol Documentation Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S70X8HQFLP"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S70X8HQFLP",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Nevermined Core Protocol Documentation" href="/opensearch.xml">


<link rel="stylesheet" href="/lib/nvm-one-widget.css"><link rel="stylesheet" href="/assets/css/styles.13998e36.css">
<link rel="preload" href="/assets/js/runtime~main.c99dc4fe.js" as="script">
<link rel="preload" href="/assets/js/main.abf2f6bf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/nevermined/nevermined_logo.svg" alt="Nevermined Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/nevermined/nevermined_logo.svg" alt="Nevermined Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/getting-started">Getting Started</a><a class="navbar__item navbar__link" href="/docs/nevermined-sdk/getting-started">SDK</a><a class="navbar__item navbar__link" href="/docs/tutorials">Tutorials</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://discord.gg/GZju2qScKq" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><img src="/nevermined/discord-gray.svg" alt="Discord" class="discord"></a><a href="https://github.com/nevermined-io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><img src="/nevermined/github-gray.svg" alt="Github" class="github"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started/">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/nevermined-sdk/intro">Nevermined SDK</a><button aria-label="Toggle the collapsible sidebar category &#x27;Nevermined SDK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/cli/">CLI</a><button aria-label="Toggle the collapsible sidebar category &#x27;CLI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tutorials/">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/environments/">Environments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Environments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/architecture/">Protocol Architecture</a><button aria-label="Toggle the collapsible sidebar category &#x27;Protocol Architecture&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/what-can-i-do">What can I do with my assets?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/building-dapps">Building decentralized applications with Nevermined</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/building-blocks">Building Blocks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/nevermined-data">Information available in Nevermined</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/architecture/contracts/">Smart Contracts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Smart Contracts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/architecture/marketplace-api/">Marketplace API</a><button aria-label="Toggle the collapsible sidebar category &#x27;Marketplace API&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/architecture/specs/">Specs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Specs&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-DID">Decentralized Identifiers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-METADATA">Metadata Ontology</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-NFT">NFTs Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/architecture/specs/Spec-ACCESS">Decentralized Access Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-COMPUTE">Data in situ Computation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-FL">Federated Learning Orchestration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-PROVENANCE">Decentralized Data Provenance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-DTP">Data transfer proofs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-MKT">Marketplace API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/Spec-IDM">Identity management with on-chain access control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/specs/examples/">Nevermind Specs Examples</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/architecture/node/">Nevermined Node</a><button aria-label="Toggle the collapsible sidebar category &#x27;Nevermined Node&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/category/smart-contracts">components</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/architecture/"><span itemprop="name">Protocol Architecture</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/architecture/specs/"><span itemprop="name">Specs</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Decentralized Access Control</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Decentralized Access Control</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shortname:      ACCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name:           Decentralized Access Control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type:           Standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">status:         Valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version:        0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">editor:         Aitor Argomaniz &lt;aitor@nevermined.io&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contributors:   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This SPEC introduces an integration pattern for the use of <strong>Service Execution Agreements (SEAs)</strong> (also called
&quot;Service Agreements&quot; or &quot;Agreements&quot;) as contracts between parties interacting in a transaction.
This SPEC uses the SEAs as the core element to orchestrate the publish/consume transactions for multiple services.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h2><p>The main motivations of this SPEC are:</p><ul><li>Understand how in an environment where different actors don&#x27;t trust each other, a decentralized access control can
work</li><li>Detail the interaction between parties allowing to grant access to assets in a decentralized manner</li><li>Identify the API methods exposed via the different libraries</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="actors-and-technical-components">Actors and Technical Components<a href="#actors-and-technical-components" class="hash-link" aria-label="Direct link to Actors and Technical Components" title="Direct link to Actors and Technical Components">​</a></h2><ul><li>PUBLISHERS - Provide access to assets and/or services</li><li>CONSUMERS - Want to get access to assets and/or services</li><li>MARKETPLACES - Store the DDO (including metadata) associated with the assets and/or services</li></ul><p>Note: Below, we write &quot;assets&quot; to mean &quot;assets and/or services.&quot;</p><p>The following technical components are involved with the publishing flow or the consumption flow:</p><ul><li><strong>MARKETPLACE</strong> - Exposes a web interface allowing users to publish and purchase assets.
It also facilitates the discovery of assets.</li><li><strong>SDK</strong> - Software library encapsulating the Nevermined business logic. It&#x27;s used to interact with all the
components &amp; APIs of the system. It&#x27;s currently implemented in the following packages:<ul><li><a href="https://github.com/nevermined-io/sdk-js" target="_blank" rel="noopener noreferrer">nevermined-sdk-js</a> - JavaScript version of the Nevermined SDK to be
integrated with front-end applications.</li><li><a href="https://github.com/nevermined-io/sdk-py" target="_blank" rel="noopener noreferrer">nevermined-sdk-py</a> - Python version of the Nevermined SDK to be
integrated with back-end applications. The primary users are data scientists.</li><li><a href="https://github.com/nevermined-io/sdk-java" target="_blank" rel="noopener noreferrer">nevermined-sdk-java</a> - Java version of the Nevermined SDK to be
integrated with <a href="https://en.wikipedia.org/wiki/Java_virtual_machine" target="_blank" rel="noopener noreferrer">JVM</a> applications. The primary users are
data engineers.</li></ul></li><li><a href="https://github.com/nevermined-io/contracts" target="_blank" rel="noopener noreferrer">SMART CONTRACTS</a> - Solidity Smart Contracts providing the Service
Agreements business logic.</li><li><a href="https://github.com/nevermined-io/node" target="_blank" rel="noopener noreferrer">NEVERMINED NODE</a> - Microservice to be executed by PUBLISHERS. It exposes an
HTTP REST API permitting access to PUBLISHER assets or additional services such as computation.</li><li><a href="https://github.com/nevermined-io/marketplace-api" target="_blank" rel="noopener noreferrer">MARKETPLACE-API</a> - Microservice to be executed by MARKETPLACES.
Facilitates   creating, updating, deleting and searching the asset metadata registered by the PUBLISHERS.
This metadata is included as part of a DDO (see <a href="/docs/architecture/specs/Spec-DID">DID SPEC</a> and
<a href="/docs/architecture/specs/Spec-METADATA">METADATA SPEC</a>) and also includes the services associated with the asset (consumption,
computation, etc.).</li></ul><p><img loading="lazy" alt="Actors running Components" src="/assets/images/software-run-by-actors-361cc2d599bedb8859e532226ac70906.png" width="960" height="540" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="payment">Payment<a href="#payment" class="hash-link" aria-label="Direct link to Payment" title="Direct link to Payment">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="crypto-currencies">Crypto Currencies<a href="#crypto-currencies" class="hash-link" aria-label="Direct link to Crypto Currencies" title="Direct link to Crypto Currencies">​</a></h3><p>Nevermined allows the asset publishers to define the crypto-currencies they accept. This gives the flexibility of decide
different payments and prices depending on the currency and the service attached to the asset. In Nevermined is possible
to define multiple services (access, compute, transfer ownership, nft sales, etc). Each service can have different
payment options depending on publisher interest.</p><p>This provides a high level of flexibility allowing to get paid using the following options:</p><ul><li>Payment of a service using the Nevermined ERC20 token</li><li>Payment using an external ERC20 token</li><li>Payment using ETH</li><li>The combination of the above for the same service. What means for the same service I can ask 1000 NVM Tokens, 10 xDAI
or 1 ETH. This can be achieved specifying multiple times a service with prices in different currencies.</li></ul><p>All the prices are expressed in the DDOs with the crypto-currency lower level denominator. This is wei for ETH or drops
for any other ERC20 token.</p><p>This configuration is possible using the <code>_tokenAddress</code> parameter in the <code>LockPayment</code> and <code>EscrowPayment</code>
conditions. The value options are:</p><ul><li>If the value is <code>0x0</code> means the payment is in ETH</li><li>If the value is empty means the payment is in the Nevermined ERC20 Token</li><li>If the value is an address means the payment is using the ERC20 Token deployed on that address</li></ul><p>In the following example is using a ETH payment:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_tokenAddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;address&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0x0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rewards-distribution">Rewards Distribution<a href="#rewards-distribution" class="hash-link" aria-label="Direct link to Rewards Distribution" title="Direct link to Rewards Distribution">​</a></h3><p>In combination with the above, Nevermined allows the definition of payment schemes where multiple users can be paid for
providing a service associated to an asset. For example, it&#x27;s typical for a marketplace to get a commission for a sale
because the infrastructure provided. This can be defined case by case, each marketplace could require different
commissions, and can include multiple reward addresses to receive the payment as part of the sales flow. </p><p>This configuration is possible using the <code>_amounts</code> and <code>_receivers</code> parameters in the <code>LockPayment</code> and <code>EscrowPayment</code>
conditions. </p><p>In the following example, as part of the DDO we define that address starting by <code>0xa99</code> is going to receive a payment of
<code>10</code> drops or wei (depending on the token used), and the address starting by <code>0x068</code> a payment of 2. Example:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_amounts&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;uint256[]&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_receivers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;address[]&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;0xa99d43d86a0758d5632313b8fa3972b6088a21bb&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0x068ed00cf0441e4829d9784fcbe7b9e26d4bd8d0&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="royalties-in-the-secondary-market">Royalties in the secondary market<a href="#royalties-in-the-secondary-market" class="hash-link" aria-label="Direct link to Royalties in the secondary market" title="Direct link to Royalties in the secondary market">​</a></h3><p>Asset creators can define what are the royalties they want to receive in the secondary market. These royalties must be
between 0 and 100 percent. The royalties can not be changed after they are initialized.
This protects the buyers of an Asset or NFT to have to pay for a different commission to the one agreed during the
purchase of that Asset or NFT.</p><p>In Nevermined the Assets or NFTs can be transferred, what means the owner can be different to the original creator, but
the original creator can&#x27;t be modified in the Smart Contracts once the asset is defined.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="flows">Flows<a href="#flows" class="hash-link" aria-label="Direct link to Flows" title="Direct link to Flows">​</a></h2><p>This section describes the asset publishing flow and the asset consuming flow in detail. It should be straightforward to
implement those flows by reading it, although the actual implementation may deviate slightly.
The detailed description is an attempt to account for important edge cases and to create a good reference for the
authors of particular implementations.</p><p>The intention of the Access flow is to be as lean as possible, allowing data sharing solution with low friction.
In the below image you can see a high level view of the Nevermined Data Sharing flow:</p><p><img loading="lazy" alt="Nevermined Data Sharing flow" src="/assets/images/nevermined-data-sharing-flow-0cf89f858379dd0e4713204d394da3b7.png" width="960" height="540" class="img_ev3q"></p><p>The following parameters are used:</p><ul><li><strong>did</strong> - Decentralized Identifier (DID). See <a href="/docs/architecture/specs/Spec-DID">DID SPEC</a>.</li><li><strong>agreementId</strong> or <strong>serviceAgreementId</strong> - The unique ID referring to a Service Agreement established between a
PUBLISHER and a CONSUMER. The CONSUMER (via SDK) is the one creating this unique ID.</li><li><strong>serviceDefinitionId</strong> - Identifies one service in the array of services included in the DDO. It is created by the
PUBLISHER (via SDK) upon DDO creation.</li><li><strong>templateId</strong> - Identifies a unique Service Agreement template.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publishing-assets">Publishing Assets<a href="#publishing-assets" class="hash-link" aria-label="Direct link to Publishing Assets" title="Direct link to Publishing Assets">​</a></h3><p>When a PUBLISHER uses the Nevermined SDK to publish (register) an asset, here is a summary of what the SDK does:</p><ol><li>Construct a new DDO (JSON object describing the asset).</li><li>Calculate the checksum of all the services (access, provenance, etc) included as part of the DDO</li><li>Calculates an unique DID</li><li>Register using the Smart Contracts the DID, checksum of the DDO and the URL pointing to the METADATA API resolving
the DDO</li><li>Store the DDO off-chain in the METADATA API</li></ol><p>Those steps are explained in more detail below.</p><p>The PUBLISHER is able to publish (register) an asset by making a single SDK call.</p><p>where <code>metadata</code> is a dict containing the <a href="/docs/architecture/specs/Spec-METADATA">METADATA SPEC</a> metadata about the asset.</p><p>We now expand on the publishing (registration) steps in more detail.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="constructing-an-asset-ddo">Constructing an Asset DDO<a href="#constructing-an-asset-ddo" class="hash-link" aria-label="Direct link to Constructing an Asset DDO" title="Direct link to Constructing an Asset DDO">​</a></h4><p>An asset DDO is a <a href="https://w3c-ccg.github.io/did-spec/#did-documents" target="_blank" rel="noopener noreferrer">DID Document</a> conforming with
<a href="https://w3c-ccg.github.io/did-spec/" target="_blank" rel="noopener noreferrer">the Decentralized Identifiers (DIDs) spec</a>.</p><ol><li><p>Validate the metadata to ensure that it conforms with <a href="/docs/architecture/specs/Spec-METADATA">METADATA SPEC</a>.
(It should be in &quot;local metadata&quot; form at this point.)</p></li><li><p>Compute a DID following <a href="/docs/architecture/specs/Spec-DID">DID SPEC</a>.</p></li><li><p>Create an empty DDO and add the following things to it:</p><ul><li>DID</li><li>Public key of the PUBLISHER</li><li>Authentication section (with RSA public key)</li></ul></li><li><p>Encrypt the URLs in the <code>attributes.main.files</code> array of the metadata.
The PUBLISHER must specify which encryption service/procedure/plugin they wish to use.
That encryption service gets recorded in the asset DDO.
For details, see the section about <a href="#encryption-and-decryption">Encryption and Decryption</a> below.
Note: This step changes the metadata and also the <code>&quot;service&quot;</code> section of the DDO.</p></li><li><p>Sign the checksum using the <code>publisher_account</code> (i.e. compute a signature) and add the computed signature to the
<code>proof</code> attribute.</p></li><li><p>Add the rest of the services to the DDO.
Each service in the list contains certain information depending on its type. Here we document two types of services
required for purchasing and consuming an asset.</p><p>A service of type &quot;Access&quot; contains:</p><ul><li><p>Service Definition ID (<code>serviceDefinitionId</code>); this helps PUBLISHER find the service definition of a DDO signed by
CONSUMER</p></li><li><p>Service Agreement Template ID (<code>templateId</code>); points to an unique instance of a template of a Service Agreement</p></li><li><p>Service endpoint (<code>serviceEndpoint</code>); CONSUMERS signing this service send their signatures to this endpoint</p></li><li><p>A list of condition keys; condition key is the <code>keccak256</code> hash of the following:</p><ul><li>SLA template ID</li><li>controller contract address (obtained from the solidity contract json file matching the contract name in the SLA
condition)</li><li>controller contract function fingerprint (referred to as function signature or selector)</li></ul></li><li><p>For each condition, a list is required of its parameter values, a timeout, a set of fields determining what
conditions depend on other conditions, and a mapping of events emitted by the condition to the off-chain handlers
of these events</p></li><li><p>Each event is identified by name. Each event handler is a function from a whitelisted module</p></li><li><p>Service Agreement contract address and the event mapping in the same format as the condition events, for off-chain
listeners</p></li><li><p>An integer defining when the agreement is fulfilled in case there are multiple terminal conditions, according to
the Service Agreement smart contract</p></li></ul><p>A service of type &quot;Access&quot; contains 2 different endpoints:</p><ul><li><p><strong>serviceEndpoint</strong> - A URL to initialize the Service Agreement</p></li><li><p><strong>consumeEndpoint</strong> - A URL to fetch data decryption keys from</p><p>An example of a complete DDO can be found <a target="_blank" href="/assets/files/ddo-dataset-4cbbd8808783513694cf881a2851ebf5.json">here</a>. Please do note that the condition&#x27;s order in the DID document should reflect the same order in on-chain service agreement.</p></li></ul></li><li><p>PUBLISHER registers the DID, associating the asset DID to the METADATA API link that resolves the DID to a DDO.
To do that, the SDK needs to integrate the <code>DIDRegistry</code> contract using the <code>registerAttribute</code> method.</p></li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">registerAttribute</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter">bytes32 _did</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#393A34"><span class="token parameter">    bytes32 _checksum</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#393A34"><span class="token parameter">    address</span><span class="token parameter punctuation" style="color:#393A34">[</span><span class="token parameter punctuation" style="color:#393A34">]</span><span class="token parameter"> memory _providers</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#393A34"><span class="token parameter">    string memory _value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The parameters to pass are:</p><ul><li><strong>bytes32 _did</strong> - The hash part of the DID, the part just after <code>did:nv:</code></li><li><strong>bytes32 _checksum</strong> - The checksum generated after <a href="/docs/architecture/specs/Spec-DID#how-to-compute-a-did">compute the DID</a></li><li><strong>address[] _providers</strong> - The list of providers which PUBLISHER delegates URL decryption capabilities and SEA management</li><li><strong>string _value</strong> - The Metadata service endpoint. In the above DDO its: <a href="http://metadata.org/api/v1/metadata/assets/ddo/%7Bdid%7D" target="_blank" rel="noopener noreferrer">http://metadata.org/api/v1/metadata/assets/ddo/{did}</a></li></ul><p><img loading="lazy" alt="Publishing Flow" src="/assets/images/publishing-flow-f0c2f687d3e906751a89b7529af350e4.png" width="960" height="540" class="img_ev3q"></p><ol><li>The SMART CONTRACT will emit the <code>DIDAttributeRegistered</code> including the <code>did</code>, <code>checksum</code> and <code>url</code> registered.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-agreement-templates">Service Agreement Templates<a href="#service-agreement-templates" class="hash-link" aria-label="Direct link to Service Agreement Templates" title="Direct link to Service Agreement Templates">​</a></h3><p>It represents a standard template of a Service Agreement between parties. A template includes standard conditions
allowing to be used by Nevermined users as reference during the negotiation between parties to establish a formal
agreement on-chain.</p><p>A Service Agreement Template includes:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">* A template identifier: `templateId`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* A list of Conditions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* Timeouts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To facilitate the creation of agreements between parties, the templates provide standard agreements ready to be used
during the creation of Service Agreement instances between parties. Interaction with templates can be done via the
<code>TemplateStoreManager</code> contract.</p><p>For the Data Sharing use case, Nevermined provides the EscrowAccessSecretStore template.</p><ol><li>The EscrowAccessSecretStore Service Agreement template has the following shape:</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> agreement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">did</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> did</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">templateId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> templateId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">conditionIds</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conditionIdAccess</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conditionIdLock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conditionIdEscrow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">timeLocks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">timeLockAccess</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">timeOuts</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">timeOutAccess</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">actors</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">actors</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>For the different conditionIds, the CONSUMER needs to generate those and add them to the agreement to be defined on-chain.
This requires to generate the hash including the <strong>agreementId</strong> and all the values of the specific condition:</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> conditionIdAccess </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> accessCondition</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">generateId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">agreementId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> accessCondition</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">hashValues</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">did</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> receiver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> conditionIdLock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> lockPaymentConditon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">generateId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">agreementId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> lockPaymentConditon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">hashValues</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">escrowPayment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> escrowAmount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> conditionIdEscrow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> escrowPayment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">generateId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">agreementId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> escrowPayment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">hashValues</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">escrowAmount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> receiver</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> conditionIdLock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> conditionIdAccess</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>PUBLISHER publishes the DDO in the METADATA API.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="access">Access<a href="#access" class="hash-link" aria-label="Direct link to Access" title="Direct link to Access">​</a></h2><p>Using SDK calls, a CONSUMER can discover, purchase and get access to assets.</p><p>Steps for leveraging SDK:</p><ol><li><p>The CONSUMER uses the search method to find relevant assets related with his query. It returns a list of DDO&#x27;s.
<code>assets = nevermined.assets.search(&quot;weather Germany 2019&quot;)</code></p></li><li><p>The CONSUMER chooses a service inside a DDO (the CONSUMER selects a <code>serviceDefinitionId</code>).</p></li><li><p>The Service Agreement needs to have an associated unique <code>serviceAgreementId</code> that can be generated/provided by the
CONSUMER. In the Smart Contracts, this <code>serviceAgreementId</code> will be stored as a <code>bytes32</code>. This <code>serviceAgreementId</code>
is generated randomly and is represented by a 64-character hex string (using the characters 0-9 and a-f).
The CONSUMER can generate the <code>serviceAgreementId</code> using any kind of implementation providing enough randomness to
generate this ID (64-characters hex string).</p></li><li><p>The CONSUMER signs the service details. The signature contains <code>(templateId, valuesHashList, timeoutValues, agreementId)</code>.
The <code>agreementId</code> is provided by the CONSUMER and has to be globally unique.</p><ul><li>Each ith item in <code>values_hash_list</code> lists corresponds to the ith condition in conditions list</li><li><code>values_hash_list</code>: a hash of the parameters types and values of each condition</li></ul></li></ol><p>This signature is used to correlate events and to prevent the PUBLISHER from instantiating multiple Service Agreements from a single request.</p><ol><li>The CONSUMER sends <code>(did, serviceAgreementId, serviceDefinitionId, signature, consumerAddress)</code> to the service endpoint (NODE).
<code>serviceDefinitionId</code> tells the PUBLISHER where to find the preimage to verify the signature. The DID tells the PUBLISHER which asset to serve under these terms.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP POST /api/v1/node/services/access/initialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;did&quot;: &quot;did:nv:08a429b8529856d59867503f8056903a680935a76950bb9649785cc97869a43d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;serviceAgreementId&quot;: &quot;bb23s87856d59867503f80a690357406857698570b964ac8dcc9d86da4ada010&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;index&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;signature&quot;: &quot;cade376598342cdae231321a0097876aeda656a567a67c6767fd8710129a9dc1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;consumerAddress&quot;: &quot;0x00a329c0648769A73afAc7F9381E08FB43dBEA72&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The execution of this endpoint should return a <code>HTTP 201</code> if everything goes okay. Satisfactory conditions include:</p><ul><li><p>When NODE receives a signature from the service endpoint and verifies the signature.</p></li><li><p>Having the <code>did</code>, NODE fetches the DDO related with this <code>did</code>.</p></li><li><p>NODE records the <code>serviceAgreementId</code> as corresponding to the given <code>did</code>.</p></li><li><p>NODE executes the Service Agreement by calling <code>EscrowAccessSecretStoreTemplate.createAgreement</code>, providing it with the agreementId and all the agreement values</p></li><li><p>NODE starts listening for the <code>publisher</code> events from the events section of the service definition.</p></li></ul><ol><li>After receiving the HTTP response confirmation from NODE, the CONSUMER starts listening for the <code>AgreementCreated</code> events specified in the corresponding service definition, filtering them by <code>agreementId</code>.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="execution-of-the-service-agreement">Execution of the service agreement<a href="#execution-of-the-service-agreement" class="hash-link" aria-label="Direct link to Execution of the service agreement" title="Direct link to Execution of the service agreement">​</a></h3><p>Consider an asset purchase example. CONSUMER locks the payment. Then PUBLISHER grants access to the document. Then payment is released. Now CONSUMER may decrypt the document.</p><p>In general, there is a broad range of conditions which can be implemented and integrated into the described workflow.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="lock-payment-condition">Lock Payment Condition<a href="#lock-payment-condition" class="hash-link" aria-label="Direct link to Lock Payment Condition" title="Direct link to Lock Payment Condition">​</a></h4><p>Consider a sample of a service definition.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;serviceAgreementTemplate&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;contractName&quot;: &quot;EscrowAccessSecretStoreTemplate&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;events&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;name&quot;: &quot;AgreementCreated&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;actorType&quot;: &quot;consumer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;handler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;moduleName&quot;: &quot;escrowAccessSecretStoreTemplate&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;functionName&quot;: &quot;fulfillLockPaymentCondition&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;version&quot;: &quot;0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>According to this sample, the CONSUMER listens for the <code>AgreementCreated</code> event emitted in the very beginning of
Service Agreement execution, filtering it by <code>agreementId</code>.</p><p>Note that the structure of <code>serviceAgreementContract.events</code> is identical to <code>conditions.events</code>. SDK needs to offer a
utility that subscribes the specified callbacks to the events from both lists.</p><p>When the CONSUMER receives this event it means the agreement is in place and can perform the lock reward:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">await token.approve(lockPaymentConditon.address, escrowAmount, { from: sender })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">await lockPaymentConditon.fulfill(agreementId, escrowPayment.address, escrowAmount)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If everything goes right, it will emit <code>LockPaymentCondition.Fulfilled</code> and thus will trigger the next condition.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="grant-access-condition">Grant Access Condition<a href="#grant-access-condition" class="hash-link" aria-label="Direct link to Grant Access Condition" title="Direct link to Grant Access Condition">​</a></h4><p>PUBLISHER (via NODE) listens for <code>LockPaymentCondition.Fulfilled</code> event filtered by <code>agreementId</code> to confirm the reward was locked by the CONSUMER.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;conditions&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;events&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;Fulfilled&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;actorType&quot;: &quot;publisher&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;handler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;moduleName&quot;: &quot;lockPaymentConditon&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;functionName&quot;: &quot;fulfillAccessCondition&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;version&quot;: &quot;0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case the PUBLISHER can grant access to the CONSUMER for a specific <code>agreementId</code> and <code>documentId</code> using in this case the <code>AccessCondition.fulfill</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">await accessCondition.fulfill(agreementId, agreement.did, receiver)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If everything goes right, the Smart Contract will emit the <code>AccessCondition.Fulfilled</code> event.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="release-payment-condition">Release Payment Condition<a href="#release-payment-condition" class="hash-link" aria-label="Direct link to Release Payment Condition" title="Direct link to Release Payment Condition">​</a></h4><p>PUBLISHER (via NODE) listens for <code>AccessCondition.Fulfilled</code> event to transfer tokens to PUBLISHER&#x27;s account.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;conditions&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;events&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;Fulfilled&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;actorType&quot;: &quot;publisher&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;handler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;moduleName&quot;: &quot;access&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;functionName&quot;: &quot;fulfillEscrowPaymentCondition&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;version&quot;: &quot;0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So when the PUBLISHER receives the <code>AccessCondition.Fulfilled</code> he can call the <code>EscrowPayment.fulfill</code> method to receive the reward:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">await escrowPayment.fulfill(agreementId, escrowAmount, receiver, sender, agreement.conditionIds[1], agreement.conditionIds[0])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consuming-the-data">Consuming the Data<a href="#consuming-the-data" class="hash-link" aria-label="Direct link to Consuming the Data" title="Direct link to Consuming the Data">​</a></h2><p>CONSUMER (via SDK) listens for <code>AccessCondition.Fulfilled</code> event to access the document.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;conditions&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;events&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;TimedOut&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;actorType&quot;: &quot;consumer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;handler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;moduleName&quot;: &quot;access&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;functionName&quot;: &quot;fulfillEscrowPaymentCondition&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;version&quot;: &quot;0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following are steps that have to be performed by the CONSUMER to receive the data.</p><ol><li><p>CONSUMER decrypts the URL using the SDK. This only requires the encryptedUrl existing in the DDO and the DID.
A Parity EVM client (local or remote) and SECRET STORE cluster can be used for that.</p></li><li><p>CONSUMER retrieves data by calling the dedicated NODE endpoint (<code>serviceEndpoint</code> in the service definition)
providing it with Consumer ethereum address, service agreement ID, and decrypted URL.</p></li></ol><p>The consume URL may look like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP GET /api/v1/node/services/access/consume?consumerAddress=${consumerAddress}&amp;serviceAgreementId={serviceAgreementId}&amp;url={url}`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This method will return a HTTP 200 status code if everything was okay and the data file.</p><p>When CONSUMER requests purchased data, NODE gets 3 parameters:</p><ul><li>Consumer ethereum address: <code>consumerAddress</code></li><li>Service Agreement ID: <code>serviceAgreementId</code></li><li>Decrypted URL: <code>url</code>. This URL is only valid if NODE acts as a NODE. CONSUMER cannot download using the URL if it&#x27;s not done through NODE.</li></ul><p>Using those parameters, NODE does the following things:</p><ul><li><p>Find the <code>did</code> by the given <code>serviceAgreementId</code></p></li><li><p>Verify the given service is allowed to be consumed by the given <code>consumerAddress</code> and <code>did</code> using the <code>checkPermissions</code> method of the <code>SLA</code> Smart Contract.</p></li><li><p>If CONSUMER has permissions to consume, download and provide data for the given DID</p></li></ul><p><img loading="lazy" alt="Consuming Flow" src="/assets/images/data-sharing-flow-503e3e1bd6d936d857eb3d510dffa0d7.png" width="960" height="540" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consuming-without-direct-integration-of-secret-store">Consuming without direct integration of Secret Store<a href="#consuming-without-direct-integration-of-secret-store" class="hash-link" aria-label="Direct link to Consuming without direct integration of Secret Store" title="Direct link to Consuming without direct integration of Secret Store">​</a></h3><p>If the CONSUMER (via SDK) can&#x27;t integrate directly SECRET STORE for decryption (nevermined-sdk-js using Metamask can&#x27;t
provide the account password), it&#x27;s possible to call NODE with an alternative <code>consume</code> method.</p><p>In this scenario, the NODE is in charge of decrypting the content in behalf of the CONSUMER.</p><p>The consume URL may look like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP GET /api/v1/node/services/access/consume?pubKey=${pubKey}&amp;serviceAgreementId={serviceAgreementId}&amp;signature={signature}&amp;index={index}`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This method will return an HTTP 200 status code if everything was okay, plus the URL required to get access to the data.</p><p>When CONSUMER requests purchased data, NODE gets 3 parameters:</p><ul><li>Consumer public key: <code>pubKey</code></li><li>Service Agreement ID: <code>serviceAgreementId</code></li><li>Signature: <code>signature</code>. The signed <code>serviceAgreementId</code> value by the CONSUMER to validate his/her identity</li><li>Index: <code>index</code>. Integer value representing the position of the content to download in the <code>DDO.files</code> array</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="abort-conditions">Abort Conditions<a href="#abort-conditions" class="hash-link" aria-label="Direct link to Abort Conditions" title="Direct link to Abort Conditions">​</a></h3><p>Every condition can be fulfilled or aborted using the configured timeout.
For example it would allows to the CONSUMER to cancel the payment after locking it but not receiving access to the asset
for a long period of time. Mechanisms implemented in the Service Agreement contract ensure there are no race conditions.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="encryption-and-decryption">Encryption and Decryption<a href="#encryption-and-decryption" class="hash-link" aria-label="Direct link to Encryption and Decryption" title="Direct link to Encryption and Decryption">​</a></h2><p>The PUBLISHER can define how they want to encrypt the URLs included in the <code>attributes.main.files</code> array of the metadata.
This information must be added to the DDO to allow CONSUMERs (via SDK) to understand how to deal with the URLs.
Below is an example of how to add an encryption service to the <code>service</code> section of a DDO.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;service&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;authorization&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;service&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SecretStore&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;serviceEndpoint&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://secretstore.org:12001&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;config&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;threshold&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  …</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The encryption service is one object with the following attributes:</p><ul><li>type - Differentiate this kind of service with the word <strong>Authorization</strong></li><li>index - Existing in all the DDO services to differentiate one entry in the <code>services</code> list</li><li>serviceEndpoint (optional) - URL used during the encryption and decryption process.</li><li>attributes.main - List of mandatory attributes specific of the type<ul><li>service - The authorization service type. It could be <code>SecretStore</code>, <code>PSK_ECDSA</code> or <code>PSK_RSA</code>.</li></ul></li></ul><p>The encryption/authorization service is optional. If it&#x27;s not provided, the usual SECRET STORE cluster defined in the
SDK configuration will be used.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encryption-process">Encryption Process<a href="#encryption-process" class="hash-link" aria-label="Direct link to Encryption Process" title="Direct link to Encryption Process">​</a></h3><p>Suppose the <code>attributes.main.files</code> array in the metadata has three URLs:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;files&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://example.com/data-file-0.csv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;checksum&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;efb2c764274b745f5fc37f97c6b0e761&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;contentLength&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4535431&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;resourceId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;access-log2018-02-13-15-17-29-18386C502CAEA932&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://example.com/data-file-1.csv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;checksum&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;085340abffh21495345af97c6b0e761&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;contentLength&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;12324&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://example.com/data-file-2.csv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>attributes.main.files</code> array is encrypted as follows.
First it is converted into a string like so:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;https://example.com/data-file-0.csv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">…</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where all spaces are removed (except inside the string values). Also, all newlines, line feeds, and carriage returns
are removed. That JSON string can then be encrypted.</p><p>After encryption, all <code>&quot;url&quot;</code> keys and values are removed from the <code>attributes.main.files</code> array objects, and a new
<code>attributes.encryptedFiles</code> key and value are added to the metadata, e.g.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;encryptedFiles&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0x2e48ceefcca7abb024f90…f3fec0e1c&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We now describe the supported encryption procedures.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="authorization-types">Authorization Types<a href="#authorization-types" class="hash-link" aria-label="Direct link to Authorization Types" title="Direct link to Authorization Types">​</a></h3><p>The system supports different implementation for managing the authorization of the encryption/decryption of secrets.
The authorization type can be found in <code>attributes.main.service</code> attribute. The authorization mechanisms supported are:</p><ul><li><code>SecretStore</code> - Parity Secret Store</li><li><code>PK-ECDSA</code> - ECDSA Pre-Shared Keys</li><li><code>PK-RSA</code> - RSA Pre-Shared Keys</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-secret-store">Using Secret Store<a href="#using-secret-store" class="hash-link" aria-label="Direct link to Using Secret Store" title="Direct link to Using Secret Store">​</a></h4><p>The SECRET STORE cluster to use during the encryption and decryption is specified in the <strong>serviceEndpoint</strong> attribute, e.g.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;service&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;authorization&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;attributes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;main&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;service&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SecretStore&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;threshold&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;serviceEndpoint&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://secretstore.org:12001&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  …</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>More information about the integration of a SECRET STORE can be found
<a href="https://wiki.parity.io/Secret-Store" target="_blank" rel="noopener noreferrer">Parity Secret Store page</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-data-node">Using the Data NODE<a href="#using-the-data-node" class="hash-link" aria-label="Direct link to Using the Data NODE" title="Direct link to Using the Data NODE">​</a></h4><p>For those clients not able to integrate SECRET STORE directly, NODE will support an encryption endpoint supporting
the following parameters:</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP POST /api/v1/node/services/encrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;id&quot;: &quot;did:nv:08a429b8529856d59867503f8056903a680935a76950bb9649785cc97869a43d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;document&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;url&quot;: &quot;234ab87234acbd09543085340abffh21983ddhiiee982143827423421&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;checksum&quot;: &quot;efb2c764274b745f5fc37f97c6b0e761&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;contentLength&quot;: &quot;4535431&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;resourceId&quot;: &quot;access-log2018-02-13-15-17-29-18386C502CAEA932&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;url&quot;: &quot;234ab87234acbd6894237582309543085340abffh21983ddhiiee982143827423421&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;checksum&quot;: &quot;085340abffh21495345af97c6b0e761&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;contentLength&quot;: &quot;12324&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;url&quot;:&quot;80684089027358963495379879a543085340abffh21983ddhiiee982143827abcc2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That is, the value of <code>document</code> should be the <code>attributes.main.files</code> array.</p><p>This endpoint will return the content encrypted using the NODE account.</p><p>The NODE will expose the public keys using for encryption in the following endpoint:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://0.0.0.0:8030/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the JSON returned there will be the <code>*-public-key</code> entries with the different public keys enabled in the NODE:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property" style="color:#36acaa">&quot;ecdsa-public-key&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0xaaaaa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property" style="color:#36acaa">&quot;rsa-public-key&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0xaaaaa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="psk-ecdsa">PSK ECDSA<a href="#psk-ecdsa" class="hash-link" aria-label="Direct link to PSK ECDSA" title="Direct link to PSK ECDSA">​</a></h5><p>In a DDO definition, can be defined a Pre-Shared ECDSA mechanism using the following configuration:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;service&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;authorization&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;attributes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;main&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;service&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PSK-ECDSA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;publicKey&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0xaaaa&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ECDSA Public Key of the NODE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;serviceEndpoint&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://mynode.net/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  …</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="psk-rsa">PSK RSA<a href="#psk-rsa" class="hash-link" aria-label="Direct link to PSK RSA" title="Direct link to PSK RSA">​</a></h5><p>In a DDO definition, can be defined a Pre-Shared RSA mechanism using the following configuration:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;service&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;authorization&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;index&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;attributes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;main&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;service&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PSK-RSA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;publicKey&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0xaaaa&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// RSA Public Key of the NODE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;serviceEndpoint&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://mynode.net/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  …</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nevermined-io/docs/tree/main/docs/architecture/specs/Spec-ACCESS.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/architecture/specs/Spec-NFT"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">NFTs Engine</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/architecture/specs/Spec-COMPUTE"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Data in situ Computation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#actors-and-technical-components" class="table-of-contents__link toc-highlight">Actors and Technical Components</a></li><li><a href="#payment" class="table-of-contents__link toc-highlight">Payment</a><ul><li><a href="#crypto-currencies" class="table-of-contents__link toc-highlight">Crypto Currencies</a></li><li><a href="#rewards-distribution" class="table-of-contents__link toc-highlight">Rewards Distribution</a></li><li><a href="#royalties-in-the-secondary-market" class="table-of-contents__link toc-highlight">Royalties in the secondary market</a></li></ul></li><li><a href="#flows" class="table-of-contents__link toc-highlight">Flows</a><ul><li><a href="#publishing-assets" class="table-of-contents__link toc-highlight">Publishing Assets</a></li><li><a href="#service-agreement-templates" class="table-of-contents__link toc-highlight">Service Agreement Templates</a></li></ul></li><li><a href="#access" class="table-of-contents__link toc-highlight">Access</a><ul><li><a href="#execution-of-the-service-agreement" class="table-of-contents__link toc-highlight">Execution of the service agreement</a></li></ul></li><li><a href="#consuming-the-data" class="table-of-contents__link toc-highlight">Consuming the Data</a><ul><li><a href="#consuming-without-direct-integration-of-secret-store" class="table-of-contents__link toc-highlight">Consuming without direct integration of Secret Store</a></li><li><a href="#abort-conditions" class="table-of-contents__link toc-highlight">Abort Conditions</a></li></ul></li><li><a href="#encryption-and-decryption" class="table-of-contents__link toc-highlight">Encryption and Decryption</a><ul><li><a href="#encryption-process" class="table-of-contents__link toc-highlight">Encryption Process</a></li><li><a href="#authorization-types" class="table-of-contents__link toc-highlight">Authorization Types</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/architecture">Architecture</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials">Tutorials</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/nevermined-io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCaDKPgnEk4ekvQo2vO6FIBQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:info@nevermined.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><ul class="social-links">
                  <li>
                    <a href="https://discord.gg/GZju2qScKq" target="_blank" rel="noopener noreferrer">
                      <img src="/nevermined/discord.svg" alt="Discord" class="discord">
                    </a>
                  </li>
                  <li>
                    <a href="https://github.com/nevermined-io" target="_blank" rel="noopener noreferrer">
                      <img src="/nevermined/github.svg" alt="Github" class="github">
                    </a>
                  </li>
                  <li>
                    <a href="https://twitter.com/nevermined_io" target="_blank" rel="noopener noreferrer">
                      <img src="/nevermined/twitter.svg" alt="Twitter" class="twitter">
                    </a>
                  </li>
                  <li>
                    <a href="https://medium.com/nevermined-io" target="_blank" rel="noopener noreferrer">
                      <img src="/nevermined/medium.svg" alt="Medium" class="medium">
                    </a>
                  </li>
                </ul></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Nevermined AG.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c99dc4fe.js"></script>
<script src="/assets/js/main.abf2f6bf.js"></script>
</body>
</html>