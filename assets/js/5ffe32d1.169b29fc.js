"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[734],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||r;return n?i.createElement(h,o(o({ref:t},c),{},{components:n})):i.createElement(h,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9501:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var i=n(87462),a=(n(67294),n(3905));const r={sidebar_position:5,description:"Data in situ Computation"},o="Data in situ Computation",s={unversionedId:"architecture/specs/Spec-COMPUTE",id:"architecture/specs/Spec-COMPUTE",title:"Data in situ Computation",description:"Data in situ Computation",source:"@site/docs/architecture/specs/Spec-COMPUTE.md",sourceDirName:"architecture/specs",slug:"/architecture/specs/Spec-COMPUTE",permalink:"/docs/architecture/specs/Spec-COMPUTE",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,description:"Data in situ Computation"},sidebar:"tutorialSidebar",previous:{title:"Decentralized Access Control",permalink:"/docs/architecture/specs/Spec-ACCESS"},next:{title:"Federated Learning Orchestration",permalink:"/docs/architecture/specs/Spec-FL"}},l={},p=[{value:"Execution of Remote Compute Services using Service Agreements",id:"execution-of-remote-compute-services-using-service-agreements",level:2},{value:"Motivation",id:"motivation",level:2},{value:"Actors",id:"actors",level:2},{value:"Technical components",id:"technical-components",level:2},{value:"Flow",id:"flow",level:2},{value:"Terminology",id:"terminology",level:3},{value:"Requirements",id:"requirements",level:3},{value:"Workflows",id:"workflows",level:3},{value:"Publishing an Asset including Compute Services",id:"publishing-an-asset-including-compute-services",level:3},{value:"Setting up the Service Execution Agreement",id:"setting-up-the-service-execution-agreement",level:3},{value:"Registering Asset",id:"registering-asset",level:4},{value:"Consuming Asset",id:"consuming-asset",level:4},{value:"Execution phase",id:"execution-phase",level:3},{value:"Infrastructure Orchestration",id:"infrastructure-orchestration",level:2},{value:"Services Provided by the Operator",id:"services-provided-by-the-operator",level:3},{value:"Orchestration Steps",id:"orchestration-steps",level:3},{value:"Infrastructure Operator",id:"infrastructure-operator",level:3},{value:"Volumes",id:"volumes",level:4},{value:"Network isolation",id:"network-isolation",level:3}],c={toc:p};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,i.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"data-in-situ-computation"},"Data in situ Computation"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"shortname:      COMPUTE\nname:           Data In Situ Computation\ntype:           Standard\nstatus:         Valid\nversion:        0.1\neditor:         Aitor Argomaniz <aitor@nevermined.io>\ncontributors:   \n")),(0,a.kt)("h2",{id:"execution-of-remote-compute-services-using-service-agreements"},"Execution of Remote Compute Services using Service Agreements"),(0,a.kt)("p",null,"This SPEC introduces the integration pattern for the usage of ",(0,a.kt)("strong",{parentName:"p"},"Service Execution Agreements (SEA)"),"\n(also called Service Agreements or Agreements) as contracts between parties interacting in the execution of a\nCompute Service transaction.\nThis SPEC using the SEA as core element, orchestrates the publishing/execution of this type of compute services."),(0,a.kt)("p",null,"The intention of this SPEC is to describe the flow and integration pattern independently of the infrastructure\nCloud Compute Service.\nThis SPEC MUST be valid for integrating classical infrastructure cloud providers like Amazon EC2 or Azure,\nbut also can be used to integrate other compute providers or On-Premise infrastructure."),(0,a.kt)("p",null,"It's out of the scope to detail the Service Execution Agreements implementation."),(0,a.kt)("h2",{id:"motivation"},"Motivation"),(0,a.kt)("p",null,"The main motivations of this SPEC are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Identify the actors involved on the definition and execution of a Nevermined Compute service"),(0,a.kt)("li",{parentName:"ul"},"Detail the main characteristics of this interaction"),(0,a.kt)("li",{parentName:"ul"},"Specify the pros and cons of this approach"),(0,a.kt)("li",{parentName:"ul"},"Identify the API methods exposed via the different libraries")),(0,a.kt)("h2",{id:"actors"},"Actors"),(0,a.kt)("p",null,"The different actors interacting in this flow are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"PROVIDERS - Give access to the Compute Services"),(0,a.kt)("li",{parentName:"ul"},"CONSUMERS - Want to make use of the Compute Services"),(0,a.kt)("li",{parentName:"ul"},"MARKETPLACES or DOMAINS - Store the DDO/Metadata related with the Assets/services"),(0,a.kt)("li",{parentName:"ul"},"INFRASTRUCTURE - Cloud or on-premise infrastructure services providing computing. Typically Amazon, Azure, etc.")),(0,a.kt)("h2",{id:"technical-components"},"Technical components"),(0,a.kt)("p",null,"The following technical components are involved in an end-to-end publishing and consumption flow:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"MARKETPLACE")," - Exposes a web interface allowing the users to publish and purchase assets and services associated to\nthese assets. It also facilitates the discovery of assets."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"SDK")," - Software library encapsulating the Nevermined business logic. It's used to interact with all the\ncomponents & APIs of the system. It's currently implemented in the following package:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/nevermined-io/sdk-js"},"nevermined-sdk-js")," - JavaScript version of the Nevermined SDK to be\nintegrated with front-end applications."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/nevermined-io/contracts"},"SMART CONTRACTS")," - Solidity Smart Contracts providing the Service\nAgreements business logic."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/nevermined-io/node"},"NODE")," - Microservice to be executed by PUBLISHERS. It exposes an\nHTTP REST API permitting access to PUBLISHER assets or additional services such as computation."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/nevermined-io/marketplace-api"},"MARKETPLACE-API")," - Microservice to be executed by MARKETPLACES.\nFacilitates   creating, updating, deleting and searching the asset metadata registered by the PUBLISHERS.\nThis metadata is included as part of a DDO (see ",(0,a.kt)("a",{parentName:"li",href:"/docs/architecture/specs/Spec-DID"},"DID SPEC")," and\n",(0,a.kt)("a",{parentName:"li",href:"/docs/architecture/specs/Spec-METADATA"},"METADATA SPEC"),") and also includes the services associated with the asset (consumption,\ncomputation, etc.).")),(0,a.kt)("h2",{id:"flow"},"Flow"),(0,a.kt)("p",null,"This section describes the Asset Compute Service flow in detail.\nThere are some parameters used in this flow:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"DID")," - See ",(0,a.kt)("a",{parentName:"li",href:"/docs/architecture/specs/Spec-DID"},"DID SPEC"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"serviceAgreementId")," - Is the unique ID referring to a Service Execution Agreement established between a PUBLISHER\nand a CONSUMER. The CONSUMER (via SDK) is the one creating this random unique serviceAgreementId."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"serviceDefinitionId")," - Identifies one service in the array of services included in the DDO. It is created by the\nPUBLISHER (via SDK) upon DDO creation and is associated with different services."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"templateId")," - Identifies a unique Service Agreement template.")),(0,a.kt)("h3",{id:"terminology"},"Terminology"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Compute Provider - Entity providing a compute service for a price (or for free)."),(0,a.kt)("li",{parentName:"ul"},"Compute Service - Service offered by a Compute Provider. It could have different conditions like the type of services,\nprice, etc."),(0,a.kt)("li",{parentName:"ul"},"Workflow - It describes an execution pipeline where you put together input data and an algorithm to process this data\nand you run using a Compute Service.")),(0,a.kt)("h3",{id:"requirements"},"Requirements"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A COMPUTE PROVIDER or PROVIDER define the conditions that a Compute service supports. It includes:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"What kind of image (Docker container) can be deployed in the infrastructure"),(0,a.kt)("li",{parentName:"ul"},"What are the infrastructure resources available (CPU, memory, storage)  "),(0,a.kt)("li",{parentName:"ul"},"What is the price of using the infrastructure resources"))),(0,a.kt)("li",{parentName:"ul"},"A COMPUTE PROVIDER defines a Compute Service in the scope of the Asset (DID/DDO) of the dataset that can be computed"),(0,a.kt)("li",{parentName:"ul"},"A CONSUMER defines the task to execute modeling it in a Workflow (including configuration, input, transformations and\noutput)"),(0,a.kt)("li",{parentName:"ul"},"A workflow is a new type of Asset. It can be resolvable and be used across multiple independent compute services"),(0,a.kt)("li",{parentName:"ul"},"A CONSUMER purchasing a compute service defines which Workflow (DID) is going to execute"),(0,a.kt)("li",{parentName:"ul"},"A CONSUMER can purchase a service given by a PROVIDER and execute multiple times till the timeout expires"),(0,a.kt)("li",{parentName:"ul"},"A CONSUMER could purchase a service and execute later, the purchase MUST be totally decoupled of execution"),(0,a.kt)("li",{parentName:"ul"},"The previous two points could support to buy once a compute service and execute for example the service every night\nat 3 am")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Data in situ Computation",src:n(27030).Z,width:"960",height:"540"})),(0,a.kt)("h3",{id:"workflows"},"Workflows"),(0,a.kt)("p",null,"From a high-level point of view, a workflow may be considered a view or representation of a real work.\nA workflow consists of an orchestrated and repeatable pattern of activities transformed into tasks that transform or\nprocess information."),(0,a.kt)("p",null,"In Nevermined, we use the concept of workflow to represent a list of tasks to accomplish with the intention of process\ndata."),(0,a.kt)("p",null,"From a technical point of view, a workflow is a type of Asset (it takes advantage of all the Nevermined plumbing of\nregistering, metadata publishing, resolving, etc.).\nThe main objective of a workflow is to describe an execution pipeline. A workflow can be split in sequential stages,\nhaving each stage an input, transformation (via algorithm) and output."),(0,a.kt)("p",null,"In the below example, a workflow is modeled in a JSON document with the following characteristics:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"It has a list of sorted stages by the ",(0,a.kt)("inlineCode",{parentName:"li"},"stages.index")," parameter to be executed sequentially"),(0,a.kt)("li",{parentName:"ul"},"Each stage has a list of minimum requirements, like the image required to support the execution of the algorithm,\nminimum cpu, memory, etc."),(0,a.kt)("li",{parentName:"ul"},"Each stage has an array of sorted input parameters. Each input parameter may be:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"A DID (example: ",(0,a.kt)("inlineCode",{parentName:"li"},'"id": "did:nv:12345"'),")"),(0,a.kt)("li",{parentName:"ul"},"The output of a previous stage (example: ",(0,a.kt)("inlineCode",{parentName:"li"},'"previousIndexStage": 0'),")"))),(0,a.kt)("li",{parentName:"ul"},"Each stage has one transformation entry. It includes the id (DID) of the asset in charge of process the input to\ngenerate some output"),(0,a.kt)("li",{parentName:"ul"},"Each stage includes an entry with some additional output details. This could be a DID or a specific detail about the\nexpected output.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Workflow JSON Model",src:n(16714).Z,width:"960",height:"540"})),(0,a.kt)("p",null,"Example of a Workflow:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "service": [{\n        "index": "0",\n        "type": "metadata",\n        "serviceEndpoint": "https://service/api/v1/metadata/assets/ddo/did:nv:0ebed8226ada17fde24b6bf2b95d27f8f05fcce09139ff5cec31f6d81a7cd2ea",\n        "attributes": {\n            "main": {\n        "type": "workflow",\n        "workflow": {\n          "stages": [{\n                        "index": 0,\n                        "stageType": "Filtering",\n                        "input": [{\n                            "index": 0,\n                            "id": "did:nv:12345"\n                        }, {\n                            "index": 1,\n                            "id": "did:nv:67890"\n                        }],\n                        "transformation": {\n                            "id": "did:nv:abcde"\n                        },\n                        "output": {}\n                    }, {\n                        "index": 1,\n                        "stageType": "Transformation",\n                        "input": [{\n                            "index": 0,\n                            "previousStage": 0\n                        }],\n                        "transformation": {\n                            "id": "did:nv:999999"\n                        },\n                        "output": {}\n          }]\n      }\n      },\n      "additional": {},\n      "curation": {}\n    }\n  },\n  {}\n  ]\n}\n\n')),(0,a.kt)("p",null,"A Workflow is a new type of Asset (a part of datasets, algorithms, etc.).",(0,a.kt)("br",{parentName:"p"}),"\n","You can find a complete DDO of type workflow in the ",(0,a.kt)("a",{target:"_blank",href:n(23870).Z},"ddo-workflow.json example file"),"."),(0,a.kt)("p",null,'As a new kind of asset, the workflow details will be persisted inside a DDO as part of the "Metadata" service where\nthe ',(0,a.kt)("strong",{parentName:"p"},"type")," is ",(0,a.kt)("strong",{parentName:"p"},"workflow"),".\nAn Asset of type workflow, will include in the DDO the following information:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The Workflow model as part of the ",(0,a.kt)("inlineCode",{parentName:"li"},'DDO.services["metadata"].main.workflow')," entity"),(0,a.kt)("li",{parentName:"ul"},"The rest of the Workflow metadata information (title, author, ect.) as part of the existing Metadata service")),(0,a.kt)("p",null,"A workflow, as every DDO in Nevermined, can be resolved using the Asset Id (DID)."),(0,a.kt)("p",null,"By the time being, the workflow definition supports the execution of sequential stages.\nIt's not supported yet the execution of parallel stages."),(0,a.kt)("h3",{id:"publishing-an-asset-including-compute-services"},"Publishing an Asset including Compute Services"),(0,a.kt)("p",null,"The Compute services are published as part of the asset (dataset) metadata as an additional service offered for that\nspecific asset."),(0,a.kt)("p",null,"The complete flow of publishing an asset with a compute service attached is:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"PUBLISHER generates a DID. See ",(0,a.kt)("a",{parentName:"p",href:"/docs/architecture/specs/Spec-DID#how-to-compute-a-did"},"How to compute a DID"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"PUBLISHER creates a DDO including the following information:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"DID"),(0,a.kt)("li",{parentName:"ul"},"Metadata. It contains the asset name, description, etc. For more details see\n",(0,a.kt)("a",{parentName:"li",href:"/docs/architecture/specs/Spec-METADATA"},"METADATA SPEC"),"."),(0,a.kt)("li",{parentName:"ul"},"Public key of the PUBLISHER"),(0,a.kt)("li",{parentName:"ul"},"A list of services (Access, etc). For more details see ",(0,a.kt)("a",{parentName:"li",href:"/docs/architecture/specs/Spec-ACCESS"},"ACCESS SPEC"),".")),(0,a.kt)("p",{parentName:"li"},"Each service in the list contains certain information depending on its type.\nHere we document the ",(0,a.kt)("strong",{parentName:"p"},"Compute")," service. The ",(0,a.kt)("strong",{parentName:"p"},"Access")," and ",(0,a.kt)("strong",{parentName:"p"},"Metadata")," services where discussed in the scope of\nthe ",(0,a.kt)("a",{parentName:"p",href:"/docs/architecture/specs/Spec-ACCESS"},"ACCESS SPEC"),"."),(0,a.kt)("p",{parentName:"li"},'A service of type "compute" contains:'),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Service Definition ID (",(0,a.kt)("inlineCode",{parentName:"p"},"serviceDefinitionId"),"); this helps PUBLISHER find the service definition of a DDO signed\nby CONSUMER")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Service Agreement Template ID (",(0,a.kt)("inlineCode",{parentName:"p"},"templateId"),"); points to an instance of a Service Agreement Template stored by the\nTemplate Store Manager. In this case is a template implementing the Compute end to end flow")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Service endpoint (",(0,a.kt)("inlineCode",{parentName:"p"},"serviceEndpoint"),"); CONSUMERS signing this service send their signatures to this endpoint to\nrequest the execution of a workflow")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"A list of condition keys; condition key is the ",(0,a.kt)("inlineCode",{parentName:"p"},"keccak256")," hash of the following:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"SLA template ID"),(0,a.kt)("li",{parentName:"ul"},"controller contract address (obtained from the solidity contract json file matching the contract name in the\nSLA condition)"),(0,a.kt)("li",{parentName:"ul"},"controller contract function fingerprint (referred to as function signature or selector)"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"For each condition, a list is required of its parameter values, a timeout, a set of fields determining what\nconditions depend on other conditions, and a mapping of events emitted by the condition to the off-chain handlers\nof these events")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Each event is identified by name. Each event handler is a function from a whitelisted module")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Service Agreement contract address and the event mapping in the same format as the condition events, for off-chain\nlisteners")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"An integer defining when the agreement is fulfilled in case there are multiple terminal conditions, according to\nthe Service Agreement smart contract"))),(0,a.kt)("p",{parentName:"li"},'A service of type "compute" contains one endpoint:'),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"serviceEndpoint")," - A URL to call when the CONSUMER request the execution of a workflow"),(0,a.kt)("p",{parentName:"li"},"An example of a complete DDO can be found ",(0,a.kt)("a",{target:"_blank",href:n(23870).Z},"here"),". Please do note that the condition's\norder in the DID document should reflect the same order in on-chain service agreement.")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"PUBLISHER publishes the DDO in the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/nevermined-io/marketplace-api"},"MARKETPLACE-API"),'.\nThis DDO must include at least one service of type "compute".'))),(0,a.kt)("p",null,(0,a.kt)("a",{target:"_blank",href:n(12102).Z},"here")," you have an example of the DDO including a Compute service.\nBelow you can find a small fraction of this:"),(0,a.kt)("p",null,'"container":'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'  "service": [{\n        "type": "compute",\n        "serviceDefinitionId": "2",\n        "serviceEndpoint": "http://mynode.org/api/v1/node/services/execute",\n        "templateId": "804932804923850985093485039850349850439583409583404534231321131a",\n\n        "attributes": {\n\n\n        "main": {\n\n            "creator": "0x00Bd138aBD70e2F00903268F3Db08f2D25677C9e",\n            "datePublished": "2019-04-09T19:02:11Z",\n            "provider": {\n                "type": "Azure",\n                "description": "",\n                "environment": {\n                    "cluster": {\n                        "type": "Kubernetes",\n                        "url": "http://10.0.0.17/xxx"\n                    },\n                    "supportedContainers": [{\n                        "image": "tensorflow/tensorflow",\n                        "tag": "latest",\n                        "checksum": "sha256:cb57ecfa6ebbefd8ffc7f75c0f00e57a7fa739578a429b6f72a0df19315deadc"\n                    }, {\n                        "image": "tensorflow/tensorflow",\n                        "tag": "latest",\n                        "checksum": "sha256:cb57ecfa6ebbefd8ffc7f75c0f00e57a7fa739578a429b6f72a0df19315deadc"\n                    }],\n                    "supportedServers": [{\n                        "serverId": "1",\n                        "serverType": "xlsize",\n                        "price": "5000000000000000000",\n                        "cpu": "16",\n                        "gpu": "0",\n                        "memory": "128gb",\n                        "disk": "160gb",\n                        "maxExecutionTime": 86400\n                    }, {\n                        "containerId": "2",\n                        "typeContainer": "medium",\n                        "price": "1000000000000000000",\n                        "cpu": "2",\n                        "gpu": "0",\n                        "memory": "8gb",\n                        "disk": "80gb",\n                        "maxExecutionTime": 86400\n                    }]\n\n                }\n            },\n\n            "serviceAgreementTemplate": {\n                "contractName": "ServiceExecutionTemplate",\n                "events": [{\n                    "name": "AgreementCreated",\n                    "actorType": "consumer",\n                    "handler": {\n                        "moduleName": "serviceExecutionTemplate",\n                        "functionName": "fulfillLockPaymentCondition",\n                        "version": "0.1"\n                    }\n                }],\n                "fulfillmentOrder": [\n                    "lockPayment.fulfill",\n                    "serviceExecution.fulfill",\n                    "escrowPayment.fulfill"\n                ],\n                "conditionDependency": {\n                    "lockPayment": [],\n                    "serviceExecution": [],\n                    "releaseReward": [\n                        "lockPayment",\n                        "serviceExecution"\n                    ]\n                },\n                "conditions": [{\n                        "name": "lockPayment",\n                        "timelock": 0,\n                        "timeout": 0,\n                        "contractName": "LockPaymentCondition",\n                        "functionName": "fulfill",\n                        "parameters": [\n                            {\n                                "name": "_did",\n                                "type": "bytes32",\n                                "value": ""\n                            },\n                            {\n                                "name": "_rewardAddress",\n                                "type": "address",\n                                "value": ""\n                            },\n                            {\n                                "name": "_tokenAddress",\n                                "type": "address",\n                                "value": ""\n                            },\n                            {\n                                "name": "_amounts",\n                                "type": "uint256[]",\n                                "value": []\n                            },\n                            {\n                                "name": "_receivers",\n                                "type": "address[]",\n                              "value": []\n                            }\n                        ],\n                        "events": [{\n                            "name": "Fulfilled",\n                            "actorType": "publisher",\n                            "handler": {\n                                "moduleName": "lockPaymentConditon",\n                                "functionName": "fulfillServiceExecutionCondition",\n                                "version": "0.1"\n                            }\n                        }]\n                    },\n                    {\n                        "name": "execCompute",\n                        "timelock": 0,\n                        "timeout": 0,\n                        "contractName": "ComputeExecutionCondition",\n                        "functionName": "fulfill",\n                        "parameters": [{\n                                "name": "_did",\n                                "type": "bytes32",\n                                "value": ""\n                            },\n                            {\n                                "name": "_grantee",\n                                "type": "address",\n                                "value": ""\n                            }\n                        ],\n                        "events": [{\n                                "name": "Fulfilled",\n                                "actorType": "publisher",\n                                "handler": {\n                                    "moduleName": "execCompute",\n                                    "functionName": "fulfillServiceExecutionCondition",\n                                    "version": "0.1"\n                                }\n                            },\n                            {\n                                "name": "TimedOut",\n                                "actorType": "consumer",\n                                "handler": {\n                                    "moduleName": "execCompute",\n                                    "functionName": "fulfillServiceExecutionCondition",\n                                    "version": "0.1"\n                                }\n                            }\n                        ]\n                    },\n                    {\n                        "name": "escrowPayment",\n                        "timelock": 0,\n                        "timeout": 0,\n                        "contractName": "EscrowPaymentCondition",\n                        "functionName": "fulfill",\n                        "parameters": [\n                            {\n                                "name": "_did",\n                                "type": "bytes32",\n                                "value": ""\n                            },\n                            {\n                                "name": "_amounts",\n                                "type": "uint256[]",\n                                "value": []\n                            },\n                            {\n                                "name": "_receivers",\n                                "type": "address[]",\n                                "value": []\n                            },\n                            {\n                                "name": "_sender",\n                                "type": "address",\n                                "value": ""\n                            },\n                            {\n                                "name": "_tokenAddress",\n                                "type": "address",\n                                "value": ""\n                            },\n                            {\n                                "name": "_lockCondition",\n                                "type": "bytes32",\n                                "value": ""\n                            },\n                            {\n                                "name": "_releaseCondition",\n                                "type": "bytes32",\n                                "value": ""\n                            }\n                        ],\n                        "events": [{\n                            "name": "Fulfilled",\n                            "actorType": "publisher",\n                            "handler": {\n                                "moduleName": "escrowPaymentConditon",\n                                "functionName": "verifyRewardTokens",\n                                "version": "0.1"\n                            }\n                        }]\n                    }\n                ]\n            }\n        }\n        }\n    }]\n')),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"PUBLISHER registers the DID, associating the Asset DID to the METADATA API URL that resolves the DID to a DDO.\nTo do that, the SDK integrates the ",(0,a.kt)("inlineCode",{parentName:"li"},"DIDRegistry")," contract using the ",(0,a.kt)("inlineCode",{parentName:"li"},"registerAttribute")," method.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Publishing &amp; Executing a Compute Service",src:n(71107).Z,width:"960",height:"540"})),(0,a.kt)("h3",{id:"setting-up-the-service-execution-agreement"},"Setting up the Service Execution Agreement"),(0,a.kt)("h4",{id:"registering-asset"},"Registering Asset"),(0,a.kt)("p",null,"Using only one SDK call ",(0,a.kt)("inlineCode",{parentName:"p"},"registerAsset(asset_metadata, services_description, publisher_public_key)"),",\nthe PUBLISHER should be able to register an Asset including a ",(0,a.kt)("strong",{parentName:"p"},"Compute")," service.\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},"services_description")," attribute includes the different services (like compute) associated to this asset."),(0,a.kt)("h4",{id:"consuming-asset"},"Consuming Asset"),(0,a.kt)("p",null,"During this phase, through the CONSUMER and the PROVIDER (via NODE) negotiation,\nthe Service Execution Agreement (SEA) is created and initialized."),(0,a.kt)("p",null,"Using the SDK, a CONSUMER can discover, purchase and use the PROVIDER Compute services."),(0,a.kt)("p",null,"The complete flow for setting up the SEA is:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The CONSUMER chooses a service inside a DDO (the CONSUMER selects a ",(0,a.kt)("inlineCode",{parentName:"p"},"serviceDefinitionId"),").")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The Service Agreement needs to have an associated unique ",(0,a.kt)("inlineCode",{parentName:"p"},"serviceAgreementId")," that can be generated/provided by the\nCONSUMER. In the Smart Contracts, this ",(0,a.kt)("inlineCode",{parentName:"p"},"serviceAgreementId")," will be stored as a ",(0,a.kt)("inlineCode",{parentName:"p"},"bytes32"),".\nThis ",(0,a.kt)("inlineCode",{parentName:"p"},"serviceAgreementId")," is random and is represented by a 64-character hex string (using the characters 0-9 and\na-f).\nThe CONSUMER can generate the ",(0,a.kt)("inlineCode",{parentName:"p"},"serviceAgreementId")," using any kind of implementation providing enough randomness\nto generate this ID (64-characters hex string).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The CONSUMER signs the service details.\nThe signature contains ",(0,a.kt)("inlineCode",{parentName:"p"},"(templateId, conditionTypes, valuesHashList, timeoutValues, serviceAgreementId)"),".\n",(0,a.kt)("inlineCode",{parentName:"p"},"serviceAgreementId")," is provided by the CONSUMER and has to be globally unique."),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Each ith item in ",(0,a.kt)("inlineCode",{parentName:"li"},"values_hash_list")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"timeoutValues")," lists corresponds to the ith condition in conditionKeys"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"values_hash_list"),": a hash of the parameters types and values of each condition"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"timeoutValues"),": list of numbers to specify a timeout value for each condition.")),(0,a.kt)("p",{parentName:"li"},"It is used to correlate events and to prevent the PUBLISHER from instantiating multiple Service Agreements from a single request.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The CONSUMER initializes the SEA on-chain ",(0,a.kt)("inlineCode",{parentName:"p"},"(did, serviceAgreementId, serviceDefinitionId, signature,\nconsumerAddress, workflowId"),").")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The CONSUMER locks the payment on-chain through the ",(0,a.kt)("inlineCode",{parentName:"p"},"LockPaymentCondition")," Smart Contract")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The PROVIDER via NODE, receives the ",(0,a.kt)("inlineCode",{parentName:"p"},"LockPayment.Fulfilled")," event where he/she is the provider for this agreement")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The PROVIDER grants the execution permissions for the computation on-chain calling the\n",(0,a.kt)("inlineCode",{parentName:"p"},"executeComputeCondition.Fullfill")," method  ")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The CONSUMER gets the ",(0,a.kt)("inlineCode",{parentName:"p"},"executeComputeCondition.Fullfilled")," event. When he/she receives the event,\ncan call the NODE ",(0,a.kt)("inlineCode",{parentName:"p"},"serviceEndpoint")," url added in the DDO to start the execution of the computation workflow.\nTypically: ",(0,a.kt)("inlineCode",{parentName:"p"},"HTTP POST /api/v1/node/services/exec"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The NODE receives the CONSUMER request, and calls the ",(0,a.kt)("inlineCode",{parentName:"p"},"checkPermissions")," method to validate if the CONSUMER\naddress is granted to execute the service.\nIf user is granted, the NODE triggers the Execute Algorithm action in the infrastructure"))),(0,a.kt)("h3",{id:"execution-phase"},"Execution phase"),(0,a.kt)("p",null,"During this phase, if and only if the CONSUMER is granted, the CONSUMER can request the start of the Computation in\nthe PUBLISHER infrastructure via NODE."),(0,a.kt)("p",null,"The complete flow for the Execution phase is:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The NODE after receiving the ",(0,a.kt)("inlineCode",{parentName:"p"},"execution")," request from CONSUMER, validates the permissions using the\n",(0,a.kt)("inlineCode",{parentName:"p"},"checkPermissions")," function")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If the CONSUMER is authorized, the NODE resolves the DID of the Workflow associated with the Service Agreement.\nThe workflow includes the details of the pipeline to execute, including the different stages, inputs and outputs.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'The NODE starts the Infrastructure Operator (aka OPERATOR SERVICE), to register a new\nexecution in the PROVIDER INFRASTRUCTURE (cloud or on-premise). The NODE sends a "Workflow Registration" HTTP REST request to the OPERATOR SERVICE.\nThis request must include the serviceAgreementId and the Workflow (JSON)')),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'The OPERATOR SERVICE receives a "Workflow Registration" request and:'),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Validates in K8s there is no an existing/running workflow with the same ",(0,a.kt)("inlineCode",{parentName:"li"},"serviceAgreementId")),(0,a.kt)("li",{parentName:"ul"},"Creates an unique ",(0,a.kt)("inlineCode",{parentName:"li"},"workflowExecutionId")," identifying a unique execution of the service"),(0,a.kt)("li",{parentName:"ul"},"Validates the container flavour defined by the CONSUMER in the Workflow is supported in the compute service (DDO)"),(0,a.kt)("li",{parentName:"ul"},"Register the workflow in Kubernetes (K8s)"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"All the actions made by the OPERATOR in the infrastructure via K8s MUST include the ",(0,a.kt)("inlineCode",{parentName:"p"},"serviceAgreementId")," and\n",(0,a.kt)("inlineCode",{parentName:"p"},"workflowExecutionId")," as tags/labels")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"For each stage in the workflow, the OPERATOR orchestrates ",(0,a.kt)("a",{parentName:"p",href:"#orchestration-steps"},"Orchestration Steps"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"When a new Workflow is created in K8s, the OPERATOR ENGINE fetch the event and execute the following 3 steps:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},'Configuration - The OPERATOR ENGINE starts the "Configuration Pod". This pod is in charge of prepare the\nenvironment connecting the input volumes to a secure container. Also is in charge of resolving all the DID\'s\ninvolved into the real assets and leave everything ready for further execution. After finishing the pod is stopped.'),(0,a.kt)("li",{parentName:"ul"},'Executing - The OPERATOR ENGINE starts the "Compute Pod". This pod is in charge of using the data & algorithm\nexisting in the input volumes, execute the algorithm. The pod only can write data to the output volume.\nAfter finishing the execution of the algorithm the pod is stopped.'),(0,a.kt)("li",{parentName:"ul"},'Publishing - The OPERATOR ENGINE starts the "Publishing Pod". This pod is in charge of publishing as a new Asset\nthe result generated to the output volume. The ownership of the asset is transferred to the user triggering the\ncomputation workflow (typically the data scientist/engineer). After finishing the pod is stopped.'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The OPERATOR requests the deletion of all the containers and volumes created in the Kubernetes cluster")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The OPERATOR retrieves from the INFRASTRUCTURE (if it's available) a receipt demonstrating the execution of\nthe service")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The CONSUMER receives an event including the DID of the new ASSET created")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The NODE or any other user may requests the ",(0,a.kt)("inlineCode",{parentName:"p"},"releasePayment")," through the SMART CONTRACTS.\nIt commits on-chain the HASH of the receipt ticket collected from the INFRASTRUCTURE provider."))),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Execution Flow",src:n(1797).Z,width:"960",height:"540"})),(0,a.kt)("h2",{id:"infrastructure-orchestration"},"Infrastructure Orchestration"),(0,a.kt)("p",null,"To facilitate the infrastructure orchestration the NODE integrates with Kubernetes (aka K8s) via the OPERATOR\ncomponent. The OPERATOR allows to abstract the execution of Docker containers with compute services independently of\nthe backend (Amazon, Azure, On-Premise).\nTo support that OPERATOR includes the kubernetes driver allowing to wrap the complete execution including:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Download of the container images"),(0,a.kt)("li",{parentName:"ul"},"Setting up the pods"),(0,a.kt)("li",{parentName:"ul"},"Creation of volumes"),(0,a.kt)("li",{parentName:"ul"},"Starting and stopping the service"),(0,a.kt)("li",{parentName:"ul"},"Retrieval of logs"),(0,a.kt)("li",{parentName:"ul"},"Registering the new Asset"),(0,a.kt)("li",{parentName:"ul"},"Destroy the pods")),(0,a.kt)("p",null,"The OPERATOR handles 3 types of K8s Pods:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"Configuration Pod")," is in charge of resolve the Workflow resources necessary for the execution of the algorithm.\nIt copies the data and algorithm in volumes"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"Compute Pod")," is in charge of run the algorithm. This pod has access in read-only mode to the volumes with the input\ndata and write mode to the output volume"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"Publishing Pod")," is in charge of having all the data and logs generated in the output volume to publish this data in\nNevermined as a new asset and handover the ownership to the CONSUMER")),(0,a.kt)("h3",{id:"services-provided-by-the-operator"},"Services Provided by the Operator"),(0,a.kt)("p",null,"The services provided by the OPERATOR are:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Registering a new Workflow execution. Given a ",(0,a.kt)("inlineCode",{parentName:"li"},"serviceAgreementId")," and a ",(0,a.kt)("inlineCode",{parentName:"li"},"Workflow")," payload, starts the execution of\nthe Workflow. It returns a ",(0,a.kt)("inlineCode",{parentName:"li"},"workflowExecutionId")," valid to track the execution of the Workflow."),(0,a.kt)("li",{parentName:"ol"},"Retrieve logs. Given a ",(0,a.kt)("inlineCode",{parentName:"li"},"serviceAgreementId")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"workflowExecutionId")," retrieve the logs associated to that execution"),(0,a.kt)("li",{parentName:"ol"},"Stop workflow execution. Given a ",(0,a.kt)("inlineCode",{parentName:"li"},"serviceAgreementId")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"workflowExecutionId")," stop/delete all the containers\nassociated with them")),(0,a.kt)("h3",{id:"orchestration-steps"},"Orchestration Steps"),(0,a.kt)("p",null,"The compute scenario requires a complete orchestration of different stages in order to provide an end to end flow.\nThe steps included in this scenario are:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The CONSUMER send a request to the NODE using the ",(0,a.kt)("strong",{parentName:"p"},"compute/exec")," method in order to trigger the Workflow\nexecution")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The NODE receives this request and check on-chain via SMART CONTRACTS if the CONSUMER has grants to execute the\nWorkflow. If the CONSUMER has grants will continue the Infrastructure Operation integration, if not will return an\nerror message.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The NODE calls the Infrastructure Operator (aka OPERATOR SERVICE) giving the Workflow that needs to be executed")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The OPERATOR SERVICE communicates with the K8s cluster to register the Workflow in Kubernetes")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The OPERATOR ENGINE is registered to the new Workflow Events. When this happens The OPERATOR via K8s starts a\ngeneric ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/nevermined-io/pod-configuration"},"Configuration Pod"),".\nThe responsibilities of the configuration pod are:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Parses the Workflow document"),(0,a.kt)("li",{parentName:"ul"},"Resolves the DID resources necessary to run the Workflow"),(0,a.kt)("li",{parentName:"ul"},"Pulls the docker image from the Docker registry"),(0,a.kt)("li",{parentName:"ul"},"Plugs the different data inputs as volumes in the Compute Pod"),(0,a.kt)("li",{parentName:"ul"},"Plugs the output for data and logs as volumes in the Compute Pod"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"After all the above steps the ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration Pod")," must be stopped")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If the ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration Pod")," ends successfully the OPERATOR via K8s starts the\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/nevermined-io/pod-compute"},"Compute Pod")," using the flavour specified by the user in the\nWorkflow definition")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Compute Pod")," starts and runs the ",(0,a.kt)("inlineCode",{parentName:"p"},"compute-entrypoint.sh")," part of the algorithm downloaded by the\n",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration Pod"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"When the ",(0,a.kt)("inlineCode",{parentName:"p"},"Compute Pod")," ends or the duration is too long (timeout), the OPERATOR via K8s stop and delete\nthe Compute Pod")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"If the ",(0,a.kt)("inlineCode",{parentName:"p"},"Compute Pod")," ends, the OPERATOR start a new instance of the\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/nevermined-io/pod-publish"},"Publishing Pod"),". The responsibilities of the Publishing Pod are:"))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"List of the Log files generated in the Log volume and copy to the output"),(0,a.kt)("li",{parentName:"ul"},"List of the Output data generated in the Output volume"),(0,a.kt)("li",{parentName:"ul"},"Generate a new Asset Metadata using the information provided by the CONSUMER"),(0,a.kt)("li",{parentName:"ul"},"Register a new Asset in Nevermined including the Output & Log data generated"),(0,a.kt)("li",{parentName:"ul"},"Transfer the ownership of the new Asset created to the CONSUMER    ")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"At this point the CONSUMER could get an event of a new created asset where he/she is the owner")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Infrastructure Orchestration",src:n(63251).Z,width:"960",height:"540"})),(0,a.kt)("h3",{id:"infrastructure-operator"},"Infrastructure Operator"),(0,a.kt)("p",null,"In this SPEC the PROVIDER of a computation service is in charge of defining the\nrequirements to allow the execution of algorithms on top of the data assets.\nIt means only the images specified in the DDO by the publisher with a specific DID and checksum\nwill be allowed to be executed in the Runtime environment."),(0,a.kt)("p",null,"The OPERATOR SERVICE is in charge of setting up the runtime environment speaking with the infrastructure provider\nvia Kubernetes."),(0,a.kt)("p",null,"The images defined in the DDO and defined by the PUBLISHER only SHOULD include the minimum libraries specified,\nit will reduce the risk of executing unexpected software via external libraries.\nIn addition to this, it's recommended that the images running in the runtime environment don't have network connectivity\na part of the minimum required to get access to the Assets."),(0,a.kt)("h4",{id:"volumes"},"Volumes"),(0,a.kt)("p",null,"The input assets will be added to the runtime environment as ",(0,a.kt)("strong",{parentName:"p"},"read only")," volumes.\nThe complete paths to the folders where the volumes are mounted will be given to the algorithm as parameters,\nusing the same order of the parameters specified in the Workflow definition.\nThe new derived Asset generated as a result of the execution of the algorithm MUST be written in the output volume.\nThe pods will be ",(0,a.kt)("strong",{parentName:"p"},"destroyed")," after the execution, so only the data stored in the ",(0,a.kt)("strong",{parentName:"p"},"output")," or ",(0,a.kt)("strong",{parentName:"p"},"logs")," volumes\nshould be used."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Permissions"),(0,a.kt)("th",{parentName:"tr",align:null},"CLI Parameter"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Input"),(0,a.kt)("td",{parentName:"tr",align:null},"Read"),(0,a.kt)("td",{parentName:"tr",align:null},"--input1=/mnt/volume1 --input2=/mnt/volume2")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Output"),(0,a.kt)("td",{parentName:"tr",align:null},"Read, Write"),(0,a.kt)("td",{parentName:"tr",align:null},"--output=/mnt/output")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Logs"),(0,a.kt)("td",{parentName:"tr",align:null},"Read, Write"),(0,a.kt)("td",{parentName:"tr",align:null},"--logs=/mnt/logs")))),(0,a.kt)("h3",{id:"network-isolation"},"Network isolation"),(0,a.kt)("p",null,"The runtime environment doesn't need to have network connectivity to external networks to be executed.\nTo avoid sending the internal information about the data, it's recommended to restrict the output connectivity."))}u.isMDXComponent=!0},12102:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/files/ddo-compute-54d1db904ff187bc5e58f890659ba44c.json"},23870:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/files/ddo-workflow-9cf61abf24dfe0633bed3118db9a5b87.json"},16714:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/compute-workflow-b82dc0c07b280aaa69615b79ccbdb7fb.png"},71107:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/computing-setup-b5f641f2d5f650616b81734a7d5ffd58.png"},27030:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/data-in-situ-computation-5ad7b87b412e6c4b5f402cc7d947d643.png"},1797:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/execution-orchestration-d98161425cfa464b5763390e098f3f54.png"},63251:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/infrastructure-orchestration-1a51d6462f598a3e3b066279aa03f351.png"}}]);