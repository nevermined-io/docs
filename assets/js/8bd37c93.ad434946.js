"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3436],{3905:(e,t,i)=>{i.d(t,{Zo:()=>h,kt:()=>b});var r=i(67294);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e,t){if(null==e)return{};var i,r,s=function(e,t){if(null==e)return{};var i,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||(s[i]=e[i]);return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}var c=r.createContext({}),l=function(e){var t=r.useContext(c),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},h=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var i=e.components,s=e.mdxType,n=e.originalType,c=e.parentName,h=a(e,["components","mdxType","originalType","parentName"]),p=l(i),b=s,d=p["".concat(c,".").concat(b)]||p[b]||u[b]||n;return i?r.createElement(d,o(o({ref:t},h),{},{components:i})):r.createElement(d,o({ref:t},h))}));function b(e,t){var i=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var n=i.length,o=new Array(n);o[0]=p;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a.mdxType="string"==typeof e?e:s,o[1]=a;for(var l=2;l<n;l++)o[l]=i[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,i)}p.displayName="MDXCreateElement"},21127:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>n,metadata:()=>a,toc:()=>l});var r=i(87462),s=(i(67294),i(3905));const n={sidebar_position:4},o="User Flows",a={unversionedId:"architecture/components/proxy/user-flows",id:"architecture/components/proxy/user-flows",title:"User Flows",description:"This page describes the potential user flows required to implement the end to end interactions of the Nevermined Proxy.",source:"@site/docs/architecture/components/proxy/user-flows.md",sourceDirName:"architecture/components/proxy",slug:"/architecture/components/proxy/user-flows",permalink:"/docs/architecture/components/proxy/user-flows",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Solution Architecture",permalink:"/docs/architecture/components/proxy/architecture"},next:{title:"NVM One",permalink:"/docs/category/nvm-one"}},c={},l=[{value:"Actors",id:"actors",level:2},{value:"End to End",id:"end-to-end",level:2},{value:"The Publisher register a new Subscription in the system",id:"the-publisher-register-a-new-subscription-in-the-system",level:3},{value:"The Publisher register a new Web Service",id:"the-publisher-register-a-new-web-service",level:3},{value:"The Subscriber purchases the subscription",id:"the-subscriber-purchases-the-subscription",level:3},{value:"The Subscriber get the access token",id:"the-subscriber-get-the-access-token",level:3},{value:"The Subscriber get access to the remote web service",id:"the-subscriber-get-access-to-the-remote-web-service",level:3}],h={toc:l};function u(e){let{components:t,...n}=e;return(0,s.kt)("wrapper",(0,r.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"user-flows"},"User Flows"),(0,s.kt)("p",null,"This page describes the potential user flows required to implement the end to end interactions of the Nevermined Proxy."),(0,s.kt)("h2",{id:"actors"},"Actors"),(0,s.kt)("p",null,"We use the following actors:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The Service Owner or ",(0,s.kt)("strong",{parentName:"li"},"Publisher"),". This actors owns/control a web service and wants to make it available under some\nconditions (payment) to the rest of the world."),(0,s.kt)("li",{parentName:"ul"},"The Service Consumer, Client or ",(0,s.kt)("strong",{parentName:"li"},"Subscriber"),". This actor wants to get access to the web service to integrate the data provided in\nhis/her application.")),(0,s.kt)("h2",{id:"end-to-end"},"End to End"),(0,s.kt)("p",null,"The end to end flow since a service is defined in the system by the Publisher till is integrated by the Client, requires the following steps:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The Publisher register a new Subscription in the system"),(0,s.kt)("li",{parentName:"ul"},"The Publisher register a new Web Service and associates it to an existing subscription NFT or creates a new one"),(0,s.kt)("li",{parentName:"ul"},"The Subscriber purchases the subscription"),(0,s.kt)("li",{parentName:"ul"},"The Subscriber get the access token associated to the subscription he/she owns"),(0,s.kt)("li",{parentName:"ul"},"The Subscriber configures the access token in the client application and get access to the Publisher API")),(0,s.kt)("h3",{id:"the-publisher-register-a-new-subscription-in-the-system"},"The Publisher register a new Subscription in the system"),(0,s.kt)("p",null,"This is the flow used by the ",(0,s.kt)("strong",{parentName:"p"},"Publisher")," to register a new subscription NFT into Nevermined. This can be skipped if the user finds an already existing subscription\nvalid. After this flow the publisher will own a NFT subsciption contract that could be used to gatekeep the access to web services.\nFor this flow publisher should provide the following information:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"General information of the subscription (Name, Description, Tags)"),(0,s.kt)("li",{parentName:"ul"},"Details of the susbcription (Duration of the subscription, Price)")),(0,s.kt)("p",null,"This process will deploy a new ERC-721 NFT Smart Contract owned by the publisher, and register a new asset into Nevermined (SUBSCRIPTION ASSET) representing that subscription."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Subscription Registration Flow",src:i(23102).Z,width:"1638",height:"915"})),(0,s.kt)("h3",{id:"the-publisher-register-a-new-web-service"},"The Publisher register a new Web Service"),(0,s.kt)("p",null,"This is the flow used by the ",(0,s.kt)("strong",{parentName:"p"},"Publisher")," to register a new web service into Nevermined. To facilitate the service discovery by the potential\nclients, the publisher should provide the following information:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"General information of the service (Name, Description, Tags, URL to documentation, etc)"),(0,s.kt)("li",{parentName:"ul"},"Service Details (Endpoint of the service). We leave service authentication for a second phase."),(0,s.kt)("li",{parentName:"ul"},"The subscription associated to the service from a list of the subscriptions owned by the publisher")),(0,s.kt)("p",null,"This process will register a new asset into Nevermined (SERVICE ASSET) representing the web service the Publiher offers to the rest of the users."),(0,s.kt)("p",null,"With the service published and associated to a susbcription the publisher is done and don't need to do anything else."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Service Registration Flow",src:i(44958).Z,width:"1638",height:"915"})),(0,s.kt)("h3",{id:"the-subscriber-purchases-the-subscription"},"The Subscriber purchases the subscription"),(0,s.kt)("p",null,"In this flow the client or ",(0,s.kt)("strong",{parentName:"p"},"Subscriber")," find the service (potentially via Marketplace) and wants to get access to it. Becase that web service only\ncan be accessed to subscribers, the client needs to purchase the NFT subscription. Typically the susbcriber will be able to see all the information provided by the publisher in the metadata, and purchase if is interested."),(0,s.kt)("p",null,"When the subscriber purchases the subscription (for free subscriptions the flow is the same), a new NFT susbcription will be minted and will be owned by the subscriber."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Subscription Purchase Flow",src:i(3186).Z,width:"1638",height:"915"})),(0,s.kt)("h3",{id:"the-subscriber-get-the-access-token"},"The Subscriber get the access token"),(0,s.kt)("p",null,"In this flow the ",(0,s.kt)("strong",{parentName:"p"},"Subscriber")," owning the subscription associated to his/her wallet can get a subscription access token that can be configured in a HTTP application to make requests. These requests because this access token can authenticate the sender of them as a subscriber, allowing to give access to remote resources."),(0,s.kt)("p",null,"Because the application sending the requests typically will be an HTTP client, the configuration to be applied must be standard in HTTP. To get access to the web services the configuration provided will include the following:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"A HTTP Proxy. Including the Proxy hostname and port"),(0,s.kt)("li",{parentName:"ul"},"A HTTP Authorization Header. The value of this header will be an encoded JWT including the following information:",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"DID of the Subscription owned by the user"),(0,s.kt)("li",{parentName:"ul"},"DID of the Service to get access"),(0,s.kt)("li",{parentName:"ul"},"The public key of the subscriber")))),(0,s.kt)("p",null,"As part of the JWT message this information will be signed by the subscriber to provide a valid message that can be authenticated and authorized later."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Get Access Token Flow",src:i(18973).Z,width:"1823",height:"1019"})),(0,s.kt)("h3",{id:"the-subscriber-get-access-to-the-remote-web-service"},"The Subscriber get access to the remote web service"),(0,s.kt)("p",null,"Having the proxy configuration and the HTTP authorization header, the client can configure an application with this information to consume the service.\nAll the requests will go through the Nevermined HTTP Proxy that will have the following responsibilitites:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Deserialize the JWT message"),(0,s.kt)("li",{parentName:"ol"},"Validate the signature to authenticate the user"),(0,s.kt)("li",{parentName:"ol"},"Resolve the subscription and service DIDs"),(0,s.kt)("li",{parentName:"ol"},"Check if the subscription and service are associated. So owning the subscription gives access to the service"),(0,s.kt)("li",{parentName:"ol"},"Check the balance of the subscription NFT. At this point the proxy has 2 options:\na. Return a HTTP 401 Unauthorized error if the user don't have access/balance\nb. Proxy the user request to the final service. Add a NVM Auth header signed by the proxy")),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"API Integration Flow",src:i(93159).Z,width:"1638",height:"915"})))}u.isMDXComponent=!0},93159:(e,t,i)=>{i.d(t,{Z:()=>r});const r=i.p+"assets/images/FLOW_Api_Integration-88b296dfb8d601d18e2cb95b2f03f8f9.png"},18973:(e,t,i)=>{i.d(t,{Z:()=>r});const r=i.p+"assets/images/FLOW_Get_Access_Token-fada080d0c001dd8e9d23f0ceef5d511.png"},44958:(e,t,i)=>{i.d(t,{Z:()=>r});const r=i.p+"assets/images/FLOW_Service_Registration-cb5af49aef649baa4de8fa4d3124c0b0.png"},3186:(e,t,i)=>{i.d(t,{Z:()=>r});const r=i.p+"assets/images/FLOW_Subscription_Purchase-4ea731fefae14a7f8c23046fdda0c768.png"},23102:(e,t,i)=>{i.d(t,{Z:()=>r});const r=i.p+"assets/images/FLOW_Subscription_Registration-bb72c853228a768c9dcdbd315694d4a0.png"}}]);